---
import BaseLayout from './BaseLayout.astro';
import HeroCTA from '../components/HeroCTA.astro';
import AIReadyIntro from '../components/AIReadyIntro.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import TrustBadges from '../components/TrustBadges.astro';
import ContactFormB2B from '../components/ContactFormB2B.astro';
import FAQAccordion from '../components/FAQAccordion.astro';
import GoogleReviews from '../components/GoogleReviews.astro';
import EndCTA from '../components/EndCTA.astro';
import {
  buildLocalBusinessSchema,
  buildBreadcrumbSchema,
  buildServiceSchema,
  buildFAQSchema,
} from '../utils/schema';

const { frontmatter } = Astro.props;
const {
  title,
  description,
  heroImage,
  heroTitle,
  heroSubline,
  introText,
  b2bType,
  serviceName,
  serviceDescription,
  faq,
} = frontmatter || Astro.props;

// Schema: LocalBusiness + Breadcrumb + Service
const breadcrumbItems = [
  { name: 'Home', url: '/' },
  { name: serviceName || title, url: Astro.url.pathname },
];

const schemas: object[] = [
  buildLocalBusinessSchema(),
  buildBreadcrumbSchema(breadcrumbItems),
  buildServiceSchema(serviceName || title, serviceDescription || description),
];

if (faq && faq.length > 0) {
  schemas.push(buildFAQSchema(faq));
}
---

<BaseLayout
  title={title}
  description={description}
  schemas={schemas}
  pageType="b2b"
  serviceCategory="b2b"
  silo="gewerbe-b2b"
  targetArea="Berlin"
  showStickyCTA={false}
>
  <Breadcrumbs items={breadcrumbItems} />

  <HeroCTA
    title={heroTitle}
    subline={heroSubline}
    image={heroImage}
    imageAlt={`${serviceName || title} – Freiraum-Auflösungen Berlin`}
    primaryBtnText="Kooperationsanfrage senden"
    secondaryBtnText="Leistungskatalog ansehen"
    primaryBtnLink="#contact-b2b"
  />

  <AIReadyIntro>
    <p>{introText}</p>
  </AIReadyIntro>

  <section class="container-content py-8 max-w-4xl mx-auto prose prose-lg">
    <slot />
  </section>

  {faq && (
    <section class="container-content py-12 max-w-3xl mx-auto">
      <h2 class="text-ink mb-8 text-center">Häufige Fragen</h2>
      <FAQAccordion items={faq} />
    </section>
  )}

  <GoogleReviews headline="Das sagen unsere Kunden" maxReviews={3} variant="alt" />

  <TrustBadges />

  <section id="contact-b2b" class="container-content py-16 bg-bg-alt">
    <div class="max-w-2xl mx-auto">
      <h2 class="text-ink mb-2 text-center">Kooperationsanfrage senden</h2>
      <p class="text-center text-ink-body mb-8">Für professionelle Partner: Hausverwaltungen, Makler & Insolvenzverwalter</p>
      <ContactFormB2B context={b2bType} />
    </div>
  </section>
</BaseLayout>
