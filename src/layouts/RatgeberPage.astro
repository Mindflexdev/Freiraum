---
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import TrustBadges from '../components/TrustBadges.astro';
import CTASoft from '../components/CTASoft.astro';
import EndCTA from '../components/EndCTA.astro';
import TrustBar from '../components/TrustBar.astro';
import {
  buildBreadcrumbSchema,
  buildArticleSchema,
} from '../utils/schema';

const { frontmatter } = Astro.props;
const {
  title,
  description,
  heroImage,
  publishedDate,
  author,
  introText,
} = frontmatter || Astro.props;

// Schema: Breadcrumb + Article (KEIN LocalBusiness auf Ratgeber-Seiten)
const breadcrumbItems = [
  { name: 'Home', url: '/' },
  { name: 'Ratgeber', url: '/ratgeber/' },
  { name: title, url: Astro.url.pathname },
];

const schemas: object[] = [
  buildBreadcrumbSchema(breadcrumbItems),
  buildArticleSchema(title, description, publishedDate || new Date().toISOString().split('T')[0]),
];
---

<BaseLayout
  title={title}
  description={description}
  schemas={schemas}
  pageType="ratgeber"
  serviceCategory="info"
  showStickyCTA={true}
>
  <TrustBar />
  <Breadcrumbs items={breadcrumbItems} />

  <article class="container mx-auto px-4 py-8 max-w-3xl">
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold mb-4">{title}</h1>
      {introText && <p class="text-xl text-gray-600 mb-6">{introText}</p>}
      <div class="text-sm text-gray-500 flex items-center gap-4">
        {publishedDate && <span>Ver√∂ffentlicht: {publishedDate}</span>}
        {author && <span>Von: {author}</span>}
      </div>
    </header>

    {heroImage && (
      <figure class="mb-8">
        <img src={heroImage} alt={title} class="w-full h-auto rounded-lg shadow-md" loading="eager" />
      </figure>
    )}

    <div class="prose prose-lg max-w-none">
      <slot />
    </div>

    <div class="my-12">
      <CTASoft />
    </div>
  </article>

  <TrustBadges />
  <EndCTA />
</BaseLayout>
