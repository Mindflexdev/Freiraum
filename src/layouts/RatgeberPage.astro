---
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import TrustBadges from '../components/TrustBadges.astro';
import CTASoft from '../components/CTASoft.astro';
import EndCTA from '../components/EndCTA.astro';
import {
  buildBreadcrumbSchema,
  buildArticleSchema,
} from '../utils/schema';

const { frontmatter } = Astro.props;
const {
  title,
  heroTitle,
  description,
  heroImage,
  publishedDate,
  author,
  introText,
  extraSchemas,
} = frontmatter || Astro.props;

// Schema: Breadcrumb + Article (KEIN LocalBusiness auf Ratgeber-Seiten)
const breadcrumbItems = [
  { name: 'Home', url: '/' },
  { name: 'Ratgeber', url: '/ratgeber/' },
  { name: title, url: Astro.url.pathname },
];

const schemas: object[] = [
  buildBreadcrumbSchema(breadcrumbItems),
  buildArticleSchema(title, description, publishedDate || new Date().toISOString().split('T')[0], heroImage),
  ...(extraSchemas || []),
];
---

<BaseLayout
  title={title}
  description={description}
  schemas={schemas}
  pageType="ratgeber"
  ogType="article"
  serviceCategory="info"
  silo="ratgeber"
  targetArea="Berlin"
  showStickyCTA={true}
>
  <Breadcrumbs items={breadcrumbItems} />

  <article class="container-content py-8 max-w-3xl mx-auto">
    <header class="mb-8">
      <h1 class="mb-4">{heroTitle || title}</h1>
      {introText && <p class="text-xl text-ink-body mb-6">{introText}</p>}
      <div class="text-sm text-ink-light flex items-center gap-4">
        {publishedDate && <span>Ver√∂ffentlicht: {publishedDate}</span>}
        {author && <span>Von: {author}</span>}
      </div>
    </header>

    {heroImage && (
      <figure class="mb-8">
        <img src={heroImage} alt={title} class="w-full h-auto rounded-card shadow-card" width="800" height="450" loading="eager" fetchpriority="high" decoding="async" />
      </figure>
    )}

    <div class="prose prose-lg max-w-none">
      <slot />
    </div>

    <div class="my-12">
      <CTASoft />
    </div>
  </article>

  <TrustBadges />
  <EndCTA />
</BaseLayout>
